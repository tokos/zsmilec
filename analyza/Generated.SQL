/*
Created: 1.4.2013
Modified: 1.4.2013
Project: ZSMilec-DTM
Model: MySQL 5.5
Database: MySQL 5.5
*/

-- Create tables section -------------------------------------------------

-- Table SCHOOL

CREATE TABLE SCHOOL
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  NAME Varchar(30),
  ADDRESS Varchar(50),
  PHONE Varchar(20),
  EMAIL Varchar(30),
  HEADMASTER Varchar(30),
  PHONE_MESS Varchar(20),
 PRIMARY KEY (ID),
 UNIQUE ID (ID)
)
;

-- Table EMPLOYEE

CREATE TABLE EMPLOYEE
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  FIRST_NAME Varchar(20) NOT NULL,
  LAST_NAME Varchar(20) NOT NULL,
  ADDRESS Varchar(50),
  PHONE Varchar(20),
  EMAIL Varchar(30),
  ENTRY_DATE Date NOT NULL,
  POSITION Varchar(30) NOT NULL,
 PRIMARY KEY (ID),
 UNIQUE ID (ID)
)
;

-- Table EVENT

CREATE TABLE EVENT
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  EVENT_DATE Date NOT NULL,
  EVENT_TIME Time NOT NULL,
  TEXT Varchar(100) NOT NULL,
  TYPE Char(3) NOT NULL,
 PRIMARY KEY (ID),
 UNIQUE ID (ID)
)
;

-- Table COUNCIL

CREATE TABLE COUNCIL
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  NAME Varchar(20),
  START_DATE Date NOT NULL,
  END_DATE Date,
  TASKS Varchar(100),
  RESULTS Varchar(100),
 PRIMARY KEY (ID),
 UNIQUE ID (ID)
)
;

-- Table TIMETABLE

CREATE TABLE TIMETABLE
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  YEAR Varchar(9) NOT NULL,
  NAME Varchar(20),
 PRIMARY KEY (ID),
 UNIQUE ID (ID)
)
;

-- Table DAY

CREATE TABLE DAY
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  NAME Varchar(20),
  POSITION Int NOT NULL,
  TIMETABLE_ID Bigint NOT NULL,
 UNIQUE ID (ID)
)
;

ALTER TABLE DAY ADD PRIMARY KEY (TIMETABLE_ID,ID)
;

ALTER TABLE DAY ADD UNIQUE TIMETABLE_ID (TIMETABLE_ID)
;

-- Table SUBJECT

CREATE TABLE SUBJECT
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  NAME Varchar(20),
  SHORT_NAME Char(4),
  DESCRIPTION Varchar(20),
  DAY_ID Bigint NOT NULL,
  TEACHER_ID Bigint NOT NULL,
 UNIQUE ID (ID)
)
;

ALTER TABLE SUBJECT ADD PRIMARY KEY (DAY_ID,TEACHER_ID,ID)
;

-- Table PUPIL

CREATE TABLE PUPIL
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  FIRST_NAME Varchar(20) NOT NULL,
  LAST_NAME Varchar(20) NOT NULL,
  LOGIN Varchar(20) NOT NULL,
  ADDRESS Varchar(50),
  EMAIL Varchar(30),
  BIRTH_DATE Date NOT NULL,
  BIRTH_NUMBER Varchar(11),
  PARENT_CONTACT Varchar(50),
  PASSWORD Varchar(20) NOT NULL,
  PARENT_ID Bigint,
 PRIMARY KEY (ID),
 UNIQUE ID (ID)
)
;

ALTER TABLE PUPIL ADD UNIQUE LOGIN (LOGIN)
;

-- Table PARENT

CREATE TABLE PARENT
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  FIRST_NAME Varchar(20),
  LAST_NAME Varchar(20),
  LOGIN Varchar(20) NOT NULL,
  PASSWORD Varchar(20) NOT NULL,
  ADDRESS Varchar(50),
  PHONE Varchar(20),
  EMAIL Varchar(30),
 PRIMARY KEY (ID),
 UNIQUE ID (ID)
)
;

ALTER TABLE PARENT ADD UNIQUE LOGIN (LOGIN)
;

-- Table RESULT

CREATE TABLE RESULT
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  RESULT_DATE Date NOT NULL,
  NAME Varchar(30) NOT NULL,
  DESCRIPTION Varchar(30),
  EVALUATION Varchar(20) NOT NULL,
  PUPIL_ID Bigint NOT NULL,
 UNIQUE ID (ID)
)
;

ALTER TABLE RESULT ADD PRIMARY KEY (PUPIL_ID,ID)
;

-- Table TASK

CREATE TABLE TASK
(
  ID Bigint NOT NULL AUTO_INCREMENT,
  NAME Varchar(20) NOT NULL,
  DESCRIPTION Varchar(100),
  DEADLINE Date NOT NULL,
  STATE Int NOT NULL,
  COUNCIL_ID Bigint,
  SUBJECT_ID Bigint NOT NULL,
 UNIQUE ID (ID)
)
;

ALTER TABLE TASK ADD PRIMARY KEY (SUBJECT_ID,ID)
;

-- Table PUPIL_SUBJECT

CREATE TABLE PUPIL_SUBJECT
(
  PUPIL_ID Bigint NOT NULL,
  SUBJECT_ID Bigint NOT NULL
)
;

ALTER TABLE PUPIL_SUBJECT ADD PRIMARY KEY (PUPIL_ID,SUBJECT_ID)
;

-- Create relationships section ------------------------------------------------- 

ALTER TABLE DAY ADD CONSTRAINT DAY_FK1 FOREIGN KEY (TIMETABLE_ID) REFERENCES TIMETABLE (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE SUBJECT ADD CONSTRAINT SUBJECT_FK1 FOREIGN KEY (TEACHER_ID) REFERENCES EMPLOYEE (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE SUBJECT ADD CONSTRAINT SUBJECT_FK2 FOREIGN KEY (DAY_ID) REFERENCES DAY (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE PUPIL ADD CONSTRAINT PUPIL_FK1 FOREIGN KEY (PARENT_ID) REFERENCES PARENT (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE RESULT ADD CONSTRAINT RESULT_FK1 FOREIGN KEY (PUPIL_ID) REFERENCES PUPIL (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE TASK ADD CONSTRAINT TASK_FK1 FOREIGN KEY (SUBJECT_ID) REFERENCES SUBJECT (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE TASK ADD CONSTRAINT TASK_FK2 FOREIGN KEY (COUNCIL_ID) REFERENCES COUNCIL (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE PUPIL_SUBJECT ADD CONSTRAINT PUPIL_SUBJECT_FK1 FOREIGN KEY (PUPIL_ID) REFERENCES PUPIL (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE PUPIL_SUBJECT ADD CONSTRAINT PUPIL_SUBJECT_FK2 FOREIGN KEY (SUBJECT_ID) REFERENCES SUBJECT (ID) ON DELETE NO ACTION ON UPDATE NO ACTION
;


